@page "/crypto/buysell"
@using ApexCharts
@using Soenneker.Blazor.TomSelect
@using Soenneker.Blazor.TomSelect.Configuration
@using Soenneker.Blazor.TomSelect.Enums


<!-- Start::page-header -->
<div class="page-header-breadcrumb mb-3">
    <div class="d-flex align-center justify-content-between flex-wrap">
        <h1 class="page-title fw-medium fs-18 mb-0">Buy & Sell</h1>
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="javascript:void(0);">Dashboards</a></li>
            <li class="breadcrumb-item"><a href="javascript:void(0);">Crypto</a></li>
            <li class="breadcrumb-item active" aria-current="page">Buy & Sell</li>
        </ol>
    </div>
</div>
<!-- End::page-header -->

<!-- Start:: row-1 -->
<div class="row">
    @foreach (var card in BuySellDashboardCards)
    {
        <div class="col-xl-4">
            <div class="card custom-card dashboard-main-card @card.CardThemeClass">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center gap-3">
                        <div class="flex-fill">
                            <span class="d-block text-muted mb-1">@card.Pair</span>
                            <h5 class="fw-semibold">@card.Value</h5>
                            <div class="d-flex align-items-center gap-1">
                                <span class="d-block @(card.IsPositiveChange ? "text-success" : "text-danger") fs-13">
                                    <i class="ti @(card.IsPositiveChange ? "ti-arrow-narrow-up" : "ti-arrow-narrow-down") me-1 lh-1 fs-16 align-middle"></i>
                                    @card.ChangePercent
                                </span>
                                <span class="text-muted">@card.TimeFrame</span>
                            </div>
                        </div>
                        <div class="lh-1">
                            <span class="avatar avatar-lg">
                                <img src="@card.LogoUrl" alt="">
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    <div class="col-xxl-6">
        <div class="card custom-card">
            <div class="card-header justify-content-between">
                <div class="card-title">
                    Buy & Sell Statistics
                </div>
                <div class="btn-group flex-wrap" role="group" aria-label="Basic example">
                    <button type="button" class="btn btn-primary btn-sm btn-wave waves-effect waves-light">1D</button>
                    <button type="button"
                        class="btn btn-primary-light btn-sm btn-wave waves-effect waves-light">1W</button>
                    <button type="button"
                        class="btn btn-primary-light btn-sm btn-wave waves-effect waves-light">1M</button>
                    <button type="button"
                        class="btn btn-primary-light btn-sm btn-wave waves-effect waves-light">3M</button>
                    <button type="button"
                        class="btn btn-primary-light btn-sm btn-wave waves-effect waves-light">6M</button>
                    <button type="button"
                        class="btn btn-primary-light btn-sm btn-wave waves-effect waves-light">1Y</button>
                </div>
            </div>
            <div class="card-body p-0">
                <div
                    class="d-flex flex-wrap align-items-center border-bottom border-block-end-dashed mb-3 p-4 gap-5 justify-content-sm-center">
                    <div>
                        <span class="d-block fs-12">Total Buy</span>
                        <span class="d-block fw-medium fs-15 text-success">$324.25 USD</span>
                    </div>
                    <div>
                        <span class="d-block fs-12">Total Sell</span>
                        <span class="d-block fw-medium fs-15 text-danger">$4,235.25 USD</span>
                    </div>
                    <div>
                        <span class="d-block fs-12">Available Balance</span>
                        <span class="d-block fw-medium fs-15 text-primary">$22,803.92 USD</span>
                    </div>
                    <div>
                        <span class="d-block fs-12">Total Crypto Asset Value</span>
                        <span class="d-block fw-medium fs-15 text-warning">$4,56,683.00 USD</span>
                    </div>
                    <div></div>
                </div>
                <div id="buy_sell-statistics" class="px-3">
                        <ApexChart TItem="SalesStatistic" Height="372" Options="SalesStatisticChartOptions">
                                <!-- Bar Chart: Growth -->
                                <ApexPointSeries TItem="SalesStatistic"
                                                Items="salesstatistic"
                                                SeriesType="@SeriesType.Bar"
                                                Name="Buy"
                                                XValue="@(e => e.Month)"
                                                YAggregate="@(e => e.Sum(e => e.Buy))"
                                 />

                                <!-- Bar Chart: Sales -->
                                <ApexPointSeries TItem="SalesStatistic"
                                                Items="salesstatistic"
                                                SeriesType="@SeriesType.Bar"
                                                Name="Sell"
                                                XValue="@(e => e.Month)"
                                                YAggregate="@(e => e.Sum(e => e.Sell))"
                                />     
                        </ApexChart>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xxl-3 col-xl-6">
        <div class="card custom-card">
            <div class="card-header">
                <div class="card-title">
                    Quick Secure Transfer
                </div>
            </div>
            <div class="card-body">
                <div class="tab-pane border-0 p-0" id="sell-crypto" role="tabpanel" aria-labelledby="sell-crypto">
                    <div class="mb-3">
                        <span class="form-label">Crypto Value :</span>
                        <div class="position-relative">
                            <a href="javascript:void(0);" class="stretched-link"></a>
                            <div
                                class="p-2 border rounded d-flex align-items-center flex-wrap justify-content-between gap-3 mt-1">
                                <div class="gap-2 d-flex align-items-center">
                                    <div class="lh-1">
                                        <span class="avatar bg-light p-2">
                                            <img src="../assets/images/crypto-currencies/regular/Bitcoin.svg" alt="">
                                        </span>
                                    </div>
                                    <div class="fw-medium">Bitcoin - BTC</div>
                                </div>
                                <div class="text-end">
                                    <span class="fw-medium d-block">0.374638535 BTC</span>
                                    <span class="text-muted">$5,364.65</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <span class="form-label">Deposit To :</span>
                        <div class="position-relative">
                            <a href="javascript:void(0);" class="stretched-link"></a>
                            <div class="p-2 border rounded d-flex align-items-center gap-2 mt-1">
                                <div class="lh-1">
                                    <span class="avatar bg-light p-2">
                                        <i class="ri-bank-line text-info fs-20"></i>
                                    </span>
                                </div>
                                <div>
                                    <span class="fw-medium d-block">Banking</span>
                                    <span class="text-muted">Checking ...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <span class="d-block fw-medium">Amount :</span>
                        <div class="d-flex align-items-center justify-content-between text-muted">
                            <div>Weekly Bank Limit</div>
                            <div>$10,000 remaining</div>
                        </div>
                    </div>
                    <div class="input-group mb-3 flex-nowrap">
                        <input type="text" class="form-control w-100" aria-label="crypto buy select">
                        @if (isRendered)
                            {
                                <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options2" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                            }
                    </div>
                    <div>
                        <div class="fs-14 py-2">
                            <div class="d-inline-flex">
                                <span class="fw-medium text-dark">Price:</span><span
                                    class="text-muted ms-2 fs-14">6.003435</span>
                            </div>
                            <span class="text-dark fw-medium float-end">BTC</span>
                        </div>
                        <div class="fs-14 py-2">
                            <div class="d-inline-flex">
                                <span class="fw-medium text-dark">Amount:</span><span
                                    class="text-muted ms-2 fs-14">2,34,4543.00</span>
                            </div>
                            <span class="text-dark fw-medium float-end">LTC</span>
                        </div>
                    </div>
                    <div class="d-grid mt-4">
                        <button type="button" class="btn btn-success btn-wave btn-lg">Transfer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xxl-3 col-xl-6">
        <div class="card custom-card crypto-buy-sell-card">
            <div class="card-header justify-content-between pb-0">
                <div class="card-title">
                    Buy & Sell Crypto
                </div>
                <ul class="nav nav-tabs tab-style-8 scaleX" id="myTab4" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="buy-crypto-tab" data-bs-toggle="tab"
                            data-bs-target="#buy-crypto-tab-pane" type="button" role="tab"
                            aria-controls="buy-crypto-tab-pane" aria-selected="true">Buy</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="sell-crypto-tab" data-bs-toggle="tab"
                            data-bs-target="#sell-crypto-tab-pane" type="button" role="tab"
                            aria-controls="sell-crypto-tab-pane" aria-selected="false">Sell</button>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="myTabContent3">
                    <div class="tab-pane show active border-0 p-0" id="buy-crypto-tab-pane" role="tabpanel"
                        aria-labelledby="buy-crypto-tab" tabindex="0">
                        <div>
                            <div class="input-group mb-3 flex-nowrap">
                                <input type="text" class="form-control w-full" aria-label="crypto buy select"
                                    placeholder="Enter Value">
                                @if (isRendered)
                                    {
                                        <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options1" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                                    }
                            </div>
                            <div class="input-group mb-3 flex-nowrap">
                                <input type="text" class="form-control w-full" aria-label="crypto buy select"
                                    placeholder="Amount Obtained">

                                @if (isRendered)
                                    {
                                        <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options2" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                                    }
                            </div>
                            <div>
                                <div class="fs-14 py-2"><span class="fw-medium text-dark">Price:</span><span
                                        class="text-muted ms-2 fs-14 d-inline-block">6.003435</span><span
                                        class="text-dark fw-medium float-end">BTC</span></div>
                                <div class="fs-14 py-2"><span class="fw-medium text-dark">Amount:</span><span
                                        class="text-muted ms-2 fs-14 d-inline-block">2,34,4543.00</span><span
                                        class="text-dark fw-medium float-end">LTC</span></div>
                                <div class="fw-medium fs-14 py-2">Total: <span class="fs-14 d-inline-block">22.00
                                        BTC</span></div>
                                <div class="fs-12 text-success">Additional Charges: 0.32%(0.0001231 BTC)</div>
                                <label class="fw-medium fs-12 mt-4 mb-3">SELECT PAYMENT METHOD :</label>
                                <div class="row g-2">
                                    <div class="col-xl-6">
                                        <div class="p-2 border rounded">
                                            <div class="form-check mb-0">
                                                <input class="form-check-input" type="radio" name="flexRadioDefault"
                                                    id="flexRadioDefault1" checked>
                                                <label class="form-check-label fs-12" for="flexRadioDefault1">
                                                    Credit / Debit Cards
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="p-2 border rounded">
                                            <div class="form-check mb-0">
                                                <input class="form-check-input" type="radio" name="flexRadioDefault"
                                                    id="flexRadioDefault2">
                                                <label class="form-check-label fs-12" for="flexRadioDefault2">
                                                    Paypal
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-12">
                                        <div class="p-2 border rounded">
                                            <div class="form-check mb-0">
                                                <input class="form-check-input" type="radio" name="flexRadioDefault"
                                                    id="flexRadioDefault3">
                                                <label class="form-check-label fs-12" for="flexRadioDefault3">
                                                    Wallet
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-grid mt-3 pt-1">
                                <button type="button" class="btn btn-primary btn-wave btn-lg">BUY CRYPTO</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane  border-0 p-0" id="sell-crypto-tab-pane" role="tabpanel"
                        aria-labelledby="sell-crypto-tab" tabindex="0">
                        <div class="input-group mb-3 flex-nowrap">
                            <input type="text" class="form-control w-full" aria-label="crypto buy select"
                                placeholder="Select Currency">
   
                            @if (isRendered)
                                {
                                    <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options3" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                                }
                        </div>
                        <div class="input-group mb-3 flex-nowrap">
                            <input type="text" class="form-control w-full" aria-label="crypto buy select">
                            @if (isRendered)
                                {
                                    <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options4" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                                }
                        </div>
                        <div class="mb-3">
                            <span class="form-label">Crypto Value :</span>
                            <div class="position-relative">
                                <div
                                    class="p-2 border rounded d-flex align-items-center justify-content-between gap-3 mt-1 flex-wrap">
                                    <div class="gap-2 d-flex align-items-center">
                                        <div class="lh-1">
                                            <span class="avatar bg-light p-2">
                                                <img src="../assets/images/crypto-currencies/regular/Bitcoin.svg"
                                                    alt="">
                                            </span>
                                        </div>
                                        <div class="fw-medium">Bitcoin - BTC</div>
                                    </div>
                                    <div class="text-end">
                                        <span class="fw-medium d-block">0.374638535 BTC</span>
                                        <span class="text-muted">$5,364.65</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <span class="form-label">Deposit To :</span>
                            <div class="position-relative">
                                <div class="p-2 border rounded d-flex align-items-center gap-2 mt-1">
                                    <div class="lh-1">
                                        <span class="avatar bg-light p-2">
                                            <i class="ri-bank-line text-info fs-20"></i>
                                        </span>
                                    </div>
                                    <div>
                                        <span class="fw-medium d-block">Banking</span>
                                        <span class="text-muted">Checking ...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="fs-14 py-2">
                                <div class="d-inline-flex">
                                    <span class="fw-medium text-dark">Price:</span><span
                                        class="text-muted ms-2 fs-14">6.003435</span>
                                </div>
                                <span class="text-dark fw-medium float-end">BTC</span>
                            </div>
                            <div class="fs-14 py-2">
                                <div class="d-inline-flex">
                                    <span class="fw-medium text-dark">Amount:</span><span
                                        class="text-muted ms-2 fs-14">2,34,4543.00</span>
                                </div>
                                <span class="text-dark fw-medium float-end">LTC</span>
                            </div>
                        </div>
                        <div class="d-grid mt-3">
                            <button type="button" class="btn btn-danger btn-wave btn-lg">SELL CRYPTO</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End:: row-1 -->


<!-- Charts -->
@code{

    private TomSelect<SelectItem, string> _selectedValue = default!;
    
    private List<SelectItem>? _options1;    
    private List<SelectItem>? _options2;    
    private List<SelectItem>? _options3;    
    private List<SelectItem>? _options4;    
    
    private List<SelectItem> _selectedItems = new List<SelectItem>();     
    
    public class SelectItem
    {
        public string? Id { get; set; }
        public string? Name { get; set; }
        public bool Selected { get; set; }
    }      
    
    private readonly TomSelectConfiguration _configuration = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.DropdownInput, TomSelectPluginType.NoBackspaceDelete }
    };
    private readonly TomSelectConfiguration _configuration2 = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.RemoveButton, TomSelectPluginType.NoBackspaceDelete }
    };
    private bool isRendered = false;  
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isRendered = true;
            await Task.Delay(0);
            StateHasChanged(); 
        }
    }


    private List<SalesStatistic> salesstatistic { get; set; } = SalesStatisticData.GetSalesStatistic();

    private ApexChartOptions<SalesStatistic> SalesStatisticChartOptions { get; set; } = new ApexChartOptions<SalesStatistic>
    {
              
        Chart = new () {
            Height = 372,
            Toolbar = new ApexCharts.Toolbar {
                Tools = new Tools{ 
                    Zoom = false
                },
            }, 
        },
        PlotOptions = new (){
            Bar = new (){
                ColumnWidth = "50%",
                BorderRadius = 2,
            }
        },
        DataLabels = new (){
            Enabled = false
        },
        Legend = new (){
            Show = true,
            Position = ApexCharts.LegendPosition.Top,
            HorizontalAlign = ApexCharts.Align.Center,
            Markers = new (){
                StrokeWidth = 0
            },
        },
        Stroke = new (){
            Curve = Curve.Smooth,
            Width = [2, 2]
        },
        Grid = new (){
            BorderColor = "#f1f1f1",
            StrokeDashArray = 3
        }, 
       Colors = new List<string> {"var(--primary-color)", "rgba(255, 73, 205, 1)"},
       Yaxis = new List<YAxis>() {
                new YAxis {
                    Title = new AxisTitle {
                        Style = new AxisTitleStyle {
                            Color = "#adb5be",
                            FontSize = "14px",
                            FontFamily = "poppins, sans-serif",
                            FontWeight = 600,
                            CssClass = "apexcharts-yaxis-label"
                        }
                    },
                },
        },
        Xaxis =  new XAxis {
                AxisBorder = new () {
                    Show = true,
                    Color = "rgba(119, 119, 142, 0.05)",
                    OffsetX = 0,
                    OffsetY = 0,
                },
                AxisTicks = new () {
                    Show = true,
                    BorderType = ApexCharts.BorderType.Solid,
                    Color = "rgba(119, 119, 142, 0.05)",
                    OffsetX = 0,
                    OffsetY = 0,
                },
                Labels = new XAxisLabels {
                    Rotate = -90,
                },
            },
    };


    public class SalesStatistic {
        public string? Month { get; set; }
        public decimal Buy { get; set; }
        public decimal Sell { get; set; }
    };

    public static class SalesStatisticData {
        public static List<SalesStatistic> GetSalesStatistic() {
            return new List<SalesStatistic>
            {  
                new SalesStatistic { Month = "Jan", Buy = 20,  Sell = 85},
                new SalesStatistic { Month = "Feb", Buy = 38,  Sell = 65},
                new SalesStatistic { Month = "Mar", Buy = 38,  Sell = 75},
                new SalesStatistic { Month = "Apr", Buy = 72,  Sell = 38},
                new SalesStatistic { Month = "May", Buy = 55,  Sell = 85},
                new SalesStatistic { Month = "Jun", Buy = 63,  Sell = 35},
                new SalesStatistic { Month = "Jul", Buy = 43,  Sell = 62},
                new SalesStatistic { Month = "Aug", Buy = 76,  Sell = 40},
                new SalesStatistic { Month = "Sep", Buy = 55,  Sell = 40},
                new SalesStatistic { Month = "Oct", Buy = 80,  Sell = 64},
                new SalesStatistic { Month = "Nov", Buy = 40,  Sell = 50},
                new SalesStatistic { Month = "Dec", Buy = 80,  Sell = 89},
            };
        }
    }


    protected override void OnInitialized() {
        _options1 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "BTC" },
            new SelectItem { Id = "1", Name = "ETH" },
            new SelectItem { Id = "2", Name = "XRP" },
            new SelectItem { Id = "3", Name = "DASH" },
            new SelectItem { Id = "4", Name = "NEO" },
            new SelectItem { Id = "5", Name = "LTC" },
            new SelectItem { Id = "6", Name = "BSD" },
        };
        _selectedItems = _options1.Take(1).ToList();  

        _options2 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "AED" },
            new SelectItem { Id = "1", Name = "AUD" },
            new SelectItem { Id = "2", Name = "ARS" },
            new SelectItem { Id = "3", Name = "AZN" },
            new SelectItem { Id = "4", Name = "BGN" },
            new SelectItem { Id = "5", Name = "BRL" },
        };
        _selectedItems = _options2.Take(1).ToList(); 

        _options3 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "BTC" },
            new SelectItem { Id = "1", Name = "ETH" },
            new SelectItem { Id = "2", Name = "XRP" },
            new SelectItem { Id = "3", Name = "DASH" },
            new SelectItem { Id = "4", Name = "NEO" },
            new SelectItem { Id = "5", Name = "LTC" },
            new SelectItem { Id = "6", Name = "BSD" },
        };
        _selectedItems = _options3.Take(1).ToList();  

        _options4 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "AED" },
            new SelectItem { Id = "1", Name = "AUD" },
            new SelectItem { Id = "2", Name = "ARS" },
            new SelectItem { Id = "3", Name = "AZN" },
            new SelectItem { Id = "4", Name = "BGN" },
            new SelectItem { Id = "5", Name = "BRL" },
        };
        _selectedItems = _options4.Take(1).ToList();  
    }
}

@code{

    public class CryptoDashboardCard
    {
        public string Pair { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;
        public string ChangePercent { get; set; } = string.Empty;
        public bool IsPositiveChange { get; set; }
        public string TimeFrame { get; set; } = "This month";
        public string LogoUrl { get; set; } = string.Empty;
        public string CardThemeClass { get; set; } = "warning"; // e.g., "dark", "secondary"
    }
    List<CryptoDashboardCard> BuySellDashboardCards = new()
    {
        new CryptoDashboardCard {
            Pair = "BTC/USD",
            Value = "3.2265",
            ChangePercent = "1.26%",
            IsPositiveChange = true,
            LogoUrl = "../assets/images/crypto-currencies/crypto-icons/bitcoin-btc-logo.svg",
            CardThemeClass = "warning"
        },
        new CryptoDashboardCard {
            Pair = "ETH/USD",
            Value = "32.3534",
            ChangePercent = "3.64%",
            IsPositiveChange = false,
            LogoUrl = "../assets/images/crypto-currencies/crypto-icons/ethereum-eth-logo.svg",
            CardThemeClass = "dark"
        },
        new CryptoDashboardCard {
            Pair = "SOL/USD",
            Value = "32.3534",
            ChangePercent = "0.75%",
            IsPositiveChange = true,
            LogoUrl = "../assets/images/crypto-currencies/crypto-icons/solana-sol-logo.svg",
            CardThemeClass = "secondary"
        }
    };


}