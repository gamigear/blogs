@page "/projects/projectslist"
@using Soenneker.Blazor.TomSelect
@using Soenneker.Blazor.TomSelect.Configuration
@using Soenneker.Blazor.TomSelect.Enums

<!-- Start::page-header -->
<div class="page-header-breadcrumb mb-3">
    <div class="d-flex align-center justify-content-between flex-wrap">
        <h1 class="page-title fw-medium fs-18 mb-0">Projects List</h1>
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="javascript:void(0);">Apps</a></li>
            <li class="breadcrumb-item"><a href="javascript:void(0);">Projects</a></li>
            <li class="breadcrumb-item active" aria-current="page">Projects List</li>
        </ol>
    </div>
</div>
<!-- End::page-header -->

<!-- Start::row-1 -->
<div class="row">
    <div class="col-xl-12">
        <div class="card custom-card">
            <div class="card-body p-3">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                    <div class="d-flex flex-wrap gap-1 project-list-main">
                        <a href="/projects/createproject" class="btn btn-primary me-2 justify-content-center align-middle"><i
                            class="ri-add-line me-1 fw-medium align-middle"></i>New Project</a>
                        @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_sortOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                        }
                    </div>
                    <div class="avatar-list-stacked">
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/1.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/2.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/8.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/12.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/10.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/4.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/5.jpg" alt="img">
                        </span>
                        <span class="avatar avatar-sm avatar-rounded">
                            <img src="../assets/images/faces/13.jpg" alt="img">
                        </span>
                        <a class="avatar avatar-sm bg-primary avatar-rounded text-fixed-white"
                            href="javascript:void(0);">
                            +8
                        </a>
                    </div>
                    <div class="d-flex custom-project-list" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search Project" aria-label="Search">
                        <button class="btn btn-light" type="submit">Search</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End::row-1 -->

<!-- Start::row-2 -->

<div class="row">
    <div class="col-xl-12">
        <div class="card custom-card overflow-hidden">
            <div class="card-body p-0">
                <div class="table-responsive custom-border-table">
                    <table class="table text-nowrap">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Client Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Budget (USD)</th>
                                <th>Assigned Team</th>
                                <th>Priority</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var project in ProjectsData)
                            {
                                <tr>
                                    <td>@project.Title</td>
                                    <td>
                                        <div class="d-flex align-items-center gap-1">
                                            <div class="lh-1">
                                                <span class="avatar avatar-sm avatar-rounded">
                                                    <img src="@project.CompanyLogoUrl" alt="">
                                                </span>
                                            </div>
                                            <div>@project.CompanyName</div>
                                        </div>
                                    </td>
                                    <td>@project.StartDate.ToString("yyyy-MM-dd")</td>
                                    <td>@project.EndDate.ToString("yyyy-MM-dd")</td>
                                    <td>
                                        <span class="badge 
                                        bg-@(project.Status == "In Progress" ?"info" : 
                                        project.Status == "Completed"?"success" : 
                                        project.Status == "Delayed"?"warning" : 
                                        project.Status == "Not Started"?"primary" : 
                                        "secondary")-transparent">
                                        @project.Status</span>
                                    </td>
                                    <td>@project.Budget</td>
                                    <td>
                                        <div class="avatar-list-stacked">
                                            @foreach (var member in project?.TeamMembers ?? Enumerable.Empty<string>())
                                            {
                                                if (member.StartsWith("+"))
                                                {
                                                    <a class="avatar avatar-sm bg-primary avatar-rounded text-fixed-white" href="javascript:void(0);">
                                                        @member
                                                    </a>
                                                }
                                                else
                                                {
                                                    <span class="avatar avatar-sm avatar-rounded m-1">
                                                        <img src="@member" alt="img" />
                                                    </span>
                                                }
                                            }
                                        </div>
                                    </td>
                                    <td>
                                        <span class="text-@(
                                            project?.Priority == "High" ? "danger" :
                                            project?.Priority == "Medium" ? "warning" :
                                            project?.Priority == "Low" ? "primary" : "info") 
                                            d-flex align-items-center">

                                            <i class="ri-circle-fill me-1 fs-10 lh-1"></i>@project?.Priority
                                        </span>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <a aria-label="anchor" href="javascript:void(0);"
                                            class="btn btn-icon btn-sm btn-light" data-bs-toggle="dropdown"
                                            aria-expanded="false">
                                                <i class="fe fe-more-vertical"></i>
                                            </a>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item d-inline-flex align-items-center" href="javascript:void(0);"><i class="ti ti-eye me-1 align-middle"></i>View</a></li>
                                                <li><a class="dropdown-item d-inline-flex align-items-center" href="javascript:void(0);"><i class="ti ti-edit me-1 align-middle"></i>Edit</a></li>
                                                <li><a class="dropdown-item d-inline-flex align-items-center" href="javascript:void(0);" @onclick="() => DeleteItem(project!)"><i class="ti ti-trash me-1 align-middle"></i>Delete</a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    @if(ProjectsData.Count < 1){
                        <div class="text-center">
                            <p class="fw-medium m-3">No Data Availble</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End::row-2 -->
<ul class="pagination justify-content-end">
    <li class="page-item disabled">
        <a class="page-link">Previous</a>
    </li>
    <li class="page-item"><a class="page-link" href="javascript:void(0);">1</a></li>
    <li class="page-item"><a class="page-link" href="javascript:void(0);">2</a></li>
    <li class="page-item">
        <a class="page-link" href="javascript:void(0);">Next</a>
    </li>
</ul>

@code{

    public class Project
    {
        public string? Title { get; set; }
        public string? CompanyName { get; set; }
        public string? CompanyLogoUrl { get; set; }
        public DateTime StartDate { get; set; }
        public DateTime EndDate { get; set; }
        public string? Status { get; set; }
        public string? Budget { get; set; }
        public List<string>? TeamMembers { get; set; }
        public string? Priority { get; set; }
    }
    List<Project> ProjectsData = new()
    {
        new Project {
            Title = "Website Redesign",
            CompanyName = "ABC Corp",
            CompanyLogoUrl = "../assets/images/company-logos/1.png",
            StartDate = new DateTime(2025, 1, 10),
            EndDate = new DateTime(2025, 3, 15),
            Status = "In Progress",
            Budget = "$15,000",
            TeamMembers = new() {
                "../assets/images/faces/2.jpg",
                "../assets/images/faces/8.jpg",
                "../assets/images/faces/2.jpg",
                "../assets/images/faces/10.jpg",
                "+2"
            },
            Priority = "High"
        },
        new Project {
            Title = "Mobile App",
            CompanyName = "XYZ Ltd",
            CompanyLogoUrl = "../assets/images/company-logos/2.png",
            StartDate = new DateTime(2025, 2, 1),
            EndDate = new DateTime(2025, 4, 20),
            Status = "Completed",
            Budget = "$25,000",
            TeamMembers = new() {
                "../assets/images/faces/12.jpg",
                "../assets/images/faces/9.jpg",
                "../assets/images/faces/11.jpg",
                "+4"
            },
            Priority = "Medium"
        },
        new Project {
            Title = "E-commerce Platform",
            CompanyName = "FutureTech",
            CompanyLogoUrl = "../assets/images/company-logos/3.png",
            StartDate = new DateTime(2025, 3, 5),
            EndDate = new DateTime(2025, 5, 30),
            Status = "In Progress",
            Budget = "$50,000",
            TeamMembers = new() {
                "../assets/images/faces/5.jpg",
                "../assets/images/faces/6.jpg",
                "+1"
            },
            Priority = "High"
        },
        new Project {
            Title = "CRM System",
            CompanyName = "Innovate Solutions",
            CompanyLogoUrl = "../assets/images/company-logos/4.png",
            StartDate = new DateTime(2025, 1, 15),
            EndDate = new DateTime(2025, 4, 5),
            Status = "Delayed",
            Budget = "$20,000",
            TeamMembers = new() {
                "../assets/images/faces/3.jpg",
                "../assets/images/faces/9.jpg",
                "../assets/images/faces/12.jpg",
                "../assets/images/faces/11.jpg",
                "+2"
            },
            Priority = "Low"
        },
        new Project {
            Title = "Content Management System",
            CompanyName = "DesignWorks",
            CompanyLogoUrl = "../assets/images/company-logos/5.png",
            StartDate = new DateTime(2025, 2, 20),
            EndDate = new DateTime(2025, 5, 1),
            Status = "Completed",
            Budget = "$18,000",
            TeamMembers = new() {
                "../assets/images/faces/10.jpg",
                "../assets/images/faces/2.jpg",
                "../assets/images/faces/1.jpg",
                "+1"
            },
            Priority = "Medium"
        },
        new Project {
            Title = "Analytics Dashboard",
            CompanyName = "GreenTech",
            CompanyLogoUrl = "../assets/images/company-logos/6.png",
            StartDate = new DateTime(2025, 3, 1),
            EndDate = new DateTime(2025, 6, 15),
            Status = "In Progress",
            Budget = "$30,000",
            TeamMembers = new() {
                "../assets/images/faces/7.jpg",
                "../assets/images/faces/13.jpg",
            },
            Priority = "High"
        },
        new Project {
            Title = "AI Integration",
            CompanyName = "Tech Innovations",
            CompanyLogoUrl = "../assets/images/company-logos/7.png",
            StartDate = new DateTime(2025, 3, 10),
            EndDate = new DateTime(2025, 7, 1),
            Status = "Not Started",
            Budget = "$40,000",
            TeamMembers = new() {
                "../assets/images/faces/5.jpg",
                "../assets/images/faces/14.jpg",
                "../assets/images/faces/15.jpg",
                "+2"
            },
            Priority = "High"
        },
        new Project {
            Title = "SEO Optimization",
            CompanyName = "Creativa Solutions",
            CompanyLogoUrl = "../assets/images/company-logos/8.png",
            StartDate = new DateTime(2025, 1, 25),
            EndDate = new DateTime(2025, 3, 10),
            Status = "Completed",
            Budget = "$8,000",
            TeamMembers = new() {
                "../assets/images/faces/13.jpg",
                "../assets/images/faces/16.jpg",
                "+2"
            },
            Priority = "Medium"
        },
        new Project {
            Title = "HR Management System",
            CompanyName = "Innovators Inc",
            CompanyLogoUrl = "../assets/images/company-logos/9.png",
            StartDate = new DateTime(2025, 4, 1),
            EndDate = new DateTime(2025, 7, 1),
            Status = "In Progress",
            Budget = "$12,000",
            TeamMembers = new() {
                "../assets/images/faces/1.jpg",
                "../assets/images/faces/15.jpg",
                "../assets/images/faces/12.jpg",
                "../assets/images/faces/8.jpg",
                "+7"
            },
            Priority = "Medium"
        },
        new Project {
            Title = "Project Management Tool",
            CompanyName = "GreenFuture",
            CompanyLogoUrl = "../assets/images/company-logos/10.png",
            StartDate = new DateTime(2025, 2, 10),
            EndDate = new DateTime(2025, 2, 10),
            Status = "Delayed",
            Budget = "$22,000",
            TeamMembers = new() {
                "../assets/images/faces/5.jpg",
                "../assets/images/faces/11.jpg",
                "../assets/images/faces/13.jpg",
                "+4"
            },
            Priority = "Low"
        }
    };
    
    private void DeleteItem(Project project)
    {
        ProjectsData.Remove(project);
    }

}

@code{

    private bool isRendered = false;  
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isRendered = true;
            await Task.Delay(0);
            StateHasChanged(); 
        }
    }

    private string? _selectedValue = null;     
    private List<SelectItem>? _sortOptions;      
    private List<SelectItem> _selectedItems = new List<SelectItem>();    
    public class SelectItem
    {
        public string? Id { get; set; }
        public string? Name { get; set; }
        public bool Selected { get; set; }
    }


    private readonly TomSelectConfiguration _configuration = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.DropdownInput, TomSelectPluginType.NoBackspaceDelete }
    };

    protected override void OnInitialized() {


        _sortOptions = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "Newest" },
            new SelectItem { Id = "1", Name = "Date Added" },
            new SelectItem { Id = "2", Name = "Type" },
            new SelectItem { Id = "3", Name = "A - Z" },
        };


    }
}
