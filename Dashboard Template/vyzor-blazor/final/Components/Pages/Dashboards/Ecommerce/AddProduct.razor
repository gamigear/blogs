@page "/ecommerce/addproduct"
@using Soenneker.Blazor.TomSelect
@using Soenneker.Blazor.TomSelect.Configuration
@using Soenneker.Blazor.TomSelect.Enums
@using FlatpickrBlazor
@using FlatpickrBlazor.Components
@using Soenneker.Blazor.FilePond
@using Soenneker.Blazor.FilePond.Options
@using Soenneker.Blazor.FilePond.Dtos
@using Soenneker.Blazor.FilePond.Enums
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager



<!-- Quill CSS -->
<link rel="stylesheet" href="@($"{NavigationManager.BaseUri}assets/libs/quill/quill.snow.css")">
<!-- Start::page-header -->
<div class="page-header-breadcrumb mb-3">
    <div class="d-flex align-center justify-content-between flex-wrap">
        <h1 class="page-title fw-medium fs-18 mb-0">Add Product</h1>
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="javascript:void(0);">
                    Dashboards
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="javascript:void(0);">
                    Ecommerce
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Add Product</li>
        </ol>
    </div>
</div>
<!-- End::page-header -->

<!-- Start:: row-1 -->
<div class="row">
    <div class="col-xl-3">
        <div class="row">
            <div class="col-xl-12">
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">
                            Product Images
                        </div>
                    </div>
                    <div class="card-body">
                        @if (isRendered)
                        {
                            <FilePond @ref="FilePond" Options="_Warrentyoptions"></FilePond>
                            <label class="form-label text-muted mt-1 fs-13 mb-0 fw-normal">Upload 6 images, ensuring uniform size (max 2MB). Changes can be made after 24 hours. </label>
                        }
                    </div>
                </div>
            </div>
            <div class="col-xl-12">
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">
                            Product Details
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row gy-2">
                            <div class="col-xl-12">
                                <label for="publish-date" class="form-label">Publish Date</label>
                                <Flatpickr class="form-control" @ref="_flatpickr" placeholder="Choose date"/>
                            </div>
                            <div class="col-xl-12">
                                <label for="publish-time" class="form-label">Publish Time</label>
                                 <Flatpickr class="form-control" @ref="_Publishtime" Options="@_PublishtimeOptions" placeholder="Choose time" />
                            </div>
                            <div class="col-xl-12">
                                <label for="product-status-add" class="form-label">Published Status</label>
                                 @if (isRendered)
                                {
                                    <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_publishedStatusOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration" />
                                }
                            </div>
                            <div class="col-xl-12">
                                <label for="product-tags" class="form-label">Product Tags</label>
                               @if (isRendered)
                                {
                                    <TomSelect TItem="TagItem" Items="_tagItems" TType="string" Multiple="true" @bind-Value="_tagValue" Data="_productTagOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder=""  persist= "false" Create = "true" Configuration="_configuration2" />
                                }
                            </div>
                            <div class="col-xl-12">
                                <label for="product-status-add1" class="form-label">Availability</label>
                                @if (isRendered)
                                {
                                    <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_availabilityOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration" />
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-12">
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">
                            Warrenty Documents
                        </div>
                    </div>
                    <div class="card-body">
                            @if (isRendered)
                            {
                                <FilePond @ref="FilePond" Options="_Warrentyoptions"></FilePond>
                                <label class="form-label text-muted mt-1 fs-13 fw-normal mb-0">Upload warranty document (PDF/DOC, max 5MB).</label>
                            }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-9">
        <div class="card custom-card shadow-none mb-0 border-0">
            <div class="card-body p-0">
                <div class="row gy-3">
                    <div class="col-xl-12">
                        <label for="product-name-add" class="form-label">Product Name</label>
                        <input type="text" class="form-control" id="product-name-add" placeholder="Name">
                        <label for="product-name-add" class="form-label mt-1 fs-12 op-5 text-muted mb-0">*Product Name
                            should not exceed 30 characters</label>
                    </div>
                    <div class="col-xl-6">
                        <label for="product-category-add" class="form-label">Category</label>
                        @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options1" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration" />
                        }
                    </div>
                    <div class="col-xl-6">
                        <label for="product-gender-add" class="form-label">Gender</label>
                        @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options2" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration" />
                        }
                    </div>
                    <div class="col-xl-6">
                        <label for="product-size-add" class="form-label">Size</label>
                         @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options3" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration" />
                        }
                    </div>
                    <div class="col-xl-6">
                        <label for="product-brand-add" class="form-label">Brand</label>
                         @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_options4" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration" />
                        }
                    </div>
                    <div class="col-xl-6 color-selection">
                        <label for="product-color-add" class="form-label">Colors</label>
                        @if (isRendered)
                        {
                            <TomSelect TItem="TagItem" Items="_tagItems" TType="string" Multiple="true" @bind-Value="_tagValue" Data="_Colorsoptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Select" Configuration="_configuration2" />
                        }
                    </div>
                    <div class="col-xl-6">
                        <label for="product-cost-add" class="form-label">Enter Cost</label>
                        <input type="text" class="form-control" id="product-cost-add" placeholder="Cost">
                        <label for="product-cost-add" class="form-label mt-1 fs-12 op-5 text-muted mb-0">*Mention final
                            price of the product</label>
                    </div>
                    <div class="col-xl-12">
                        <label for="product-description-add" class="form-label">Product Description</label>
                        <textarea class="form-control" id="product-description-add" rows="2"></textarea>
                        <label for="product-description-add"
                            class="form-label mt-1 fs-12 op-5 text-muted mb-0">*Description should not exceed 500
                            letters</label>
                    </div>
                    <div class="col-xl-12">
                        <label class="form-label">Product Features</label>
                        <div id="product-features">
                        <BlazoredTextEditor  @ref="@QuillHtml">
                            <ToolbarContent>
                                <span class="ql-formats">
                                    <select class="ql-header">
                                        <option value="1"></option>
                                        <option value="2"></option>
                                        <option value="3"></option>
                                        <option value="4"></option>
                                        <option value="5"></option>
                                        <option value="6"></option>
                                        <option selected=""></option>
                                    </select> 
                                </span>
                                <span class="ql-formats">
                                    <select class="ql-font">
                                        <option selected="Sans Serif"></option>
                                        <option value="serif"></option>
                                        <option value="monospace"></option>
                                        <option value="Sans Serif"></option>
                                    </select>
                                </span>
                                <span class="ql-formats">
                                    <button class="ql-bold"></button>
                                    <button class="ql-italic"></button>
                                    <button class="ql-underline"></button>
                                    <button class="ql-strike"></button>
                                </span>
                                <span class="ql-formats">
                                    <button class="ql-blockquote" value="blockquote"></button>
                                    <button class="ql-code-block" value="code-block"></button>
                                </span>
                                <span class="ql-formats">
                                    <button class="ql-header" value="1"></button>
                                    <button class="ql-header" value="2"></button>
                                </span>
                                <span class="ql-formats">
                                    <button class="ql-list" value="ordered"></button>
                                    <button class="ql-list" value="bullet"></button>
                                </span>
                                <span class="ql-formats">
                                    <select class="ql-color"></select>
                                    <select class="ql-background"></select>
                                </span>
                                <span class="ql-formats">
                                    <select class="ql-align">
                                        <option selected=""></option>
                                        <option value="center"></option>
                                        <option value="right"></option>
                                        <option value="justify"></option>
                                    </select>
                                </span>
                                <span class="ql-formats">
                                    <button class="ql-clean"></button>
                                </span>   
                            </ToolbarContent>
                        </BlazoredTextEditor >
                        </div>
                    </div>
                    <div class="col-xl-4">
                        <label for="product-actual-price" class="form-label">Actual Price</label>
                        <input type="text" class="form-control" id="product-actual-price" placeholder="Actual Price">
                    </div>
                    <div class="col-xl-4">
                        <label for="product-dealer-price" class="form-label">Dealer Price</label>
                        <input type="text" class="form-control" id="product-dealer-price" placeholder="Dealer Price">
                    </div>
                    <div class="col-xl-4">
                        <label for="product-discount" class="form-label">Discount</label>
                        <input type="text" class="form-control" id="product-discount" placeholder="Discount in %">
                    </div>
                    <div class="col-xl-6">
                        <label for="product-type" class="form-label">Product Type</label>
                        <input type="text" class="form-control" id="product-type" placeholder="Type">
                    </div>
                    <div class="col-xl-6">
                        <label for="product-discount" class="form-label">Item Weight</label>
                        <input type="text" class="form-control" id="product-discount1" placeholder="Weight in gms">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="px-4 py-3 border-top border-block-start-dashed d-sm-flex justify-content-end mt-3">
        <button class="btn btn-primary-light m-1">Add Product<i class="bi bi-plus-lg ms-2"></i></button>
        <button class="btn btn-success-light m-1">Save Product<i class="bi bi-download ms-2"></i></button>
    </div>
</div>
<!-- End:: row-1 -->


@code{
    
    //QuilEditor JS Start
    BlazoredTextEditor?  QuillHtml;
    //QuilEditor JS End

    private string? _selectedValue = null; 
    private List<SelectItem>? _options1;       
    private List<SelectItem>? _options2;       
    private List<SelectItem>? _options3;       
    private List<SelectItem>? _options4;       
    private List<SelectItem>? _availabilityOptions;       
    private List<SelectItem>? _publishedStatusOptions;       
    private List<SelectItem> _selectedItems = new List<SelectItem>();        
    public class SelectItem
    {
        public string? Id { get; set; }
        public string? Name { get; set; }
        public bool Selected { get; set; }
    }

    
    private TomSelect<TagItem, string> _tagValue = default!;
    private List<TagItem>? _Colorsoptions;   
    private List<TagItem>? _productTagOptions;   
    private List<TagItem> _tagItems = new List<TagItem>();   
    public class TagItem
    {
        public string? Id { get; set; }
        public string? Name { get; set; }
        public bool Selected { get; set; }
    }      
    
    private readonly TomSelectConfiguration _configuration = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.DropdownInput, TomSelectPluginType.NoBackspaceDelete }
    };
    private readonly TomSelectConfiguration _configuration2 = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.RemoveButton, TomSelectPluginType.NoBackspaceDelete }
    };
    private bool isRendered = false;  
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isRendered = true;
            await Task.Delay(0);
            StateHasChanged(); 
        }
    }

    
    // Time Picker Start//
    public Flatpickr? _Publishtime;
    private FlatpickrBlazor.FlatpickrOptions _PublishtimeOptions = new FlatpickrBlazor.FlatpickrOptions
    {
        Inline = false,
        EnableTime = true,
        NoCalendar = true,
        DateFormat = "H:i",
    };  
    // Time Picker End// 

    // Date picker Start//
    public Flatpickr? _flatpickr;
    // Date picker End//

    // Filepond Start //
    private FilePond? FilePond { get; set; }
    private readonly FilePondOptions _Warrentyoptions = new()
    {
        MaxFiles = 20,
        AllowMultiple = true,
    };
    // Filepond End //

    protected override void OnInitialized() {
        _options1 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "Category"},
            new SelectItem { Id = "1", Name = "Clothing"},
            new SelectItem { Id = "2", Name = "Footwear"},
            new SelectItem { Id = "3", Name = "Accesories"},
            new SelectItem { Id = "4", Name = "Grooming"},
            new SelectItem { Id = "5", Name = "Ethnic & Festive"},
            new SelectItem { Id = "6", Name = "Jewellery" },
            new SelectItem { Id = "7", Name = "Toys & Babycare"},
            new SelectItem { Id = "8", Name = "Festive Gifts"},
            new SelectItem { Id = "9", Name = "Kitchen"},
            new SelectItem { Id = "10", Name = "Dining"},
            new SelectItem { Id = "11", Name = "Home Decors"},
            new SelectItem { Id = "12", Name = "Stationery"},

        };

        _options2 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "All"},
            new SelectItem { Id = "1", Name = "Male"},
            new SelectItem { Id = "2", Name = "Female"},
            new SelectItem { Id = "3", Name = "Others"},

        };

        _options3 = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "Extra Small"},
            new SelectItem { Id = "1", Name = "Small"},
            new SelectItem { Id = "2", Name = "Medium"},
            new SelectItem { Id = "3", Name = "Large"},
            new SelectItem { Id = "4", Name = "Extra Large"},

        };

        _options4 = new List<SelectItem>
        {
           new SelectItem { Id = "0", Name = "Armani"},
            new SelectItem { Id = "1", Name = "Lacoste"},
            new SelectItem { Id = "2", Name = "Puma"},
            new SelectItem { Id = "3", Name = "Spykar"},
            new SelectItem { Id = "4", Name = "Mufti"},
            new SelectItem { Id = "5", Name = "Home Town"},
            new SelectItem { Id = "6", Name = "Arrabi"},

        };
 
        _availabilityOptions = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "In Stock"},
            new SelectItem { Id = "1", Name = "Out Of Stock"},
        };

        _publishedStatusOptions = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "Published"},
            new SelectItem { Id = "1", Name = "Scheduled"},
        };

        _Colorsoptions = new List<TagItem>
        {
            new TagItem { Id = "White", Name = "White"},
            new TagItem { Id = "Black", Name = "Black"},
            new TagItem { Id = "Red", Name = "Red"},
            new TagItem { Id = "Orange", Name = "Orange"},
            new TagItem { Id = "Yellow", Name = "Yellow"},
            new TagItem { Id = "Green", Name = "Green"},
            new TagItem { Id = "Blue", Name = "Blue"},
            new TagItem { Id = "Pink", Name = "Pink"},
            new TagItem { Id = "Purple", Name = "Purple"},
        };

        _productTagOptions = new List<TagItem>
        {
            new TagItem {},
        };
    }
}