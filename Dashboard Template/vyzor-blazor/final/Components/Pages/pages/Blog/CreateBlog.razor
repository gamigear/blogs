@page "/blog/createblog"
@using Soenneker.Blazor.FilePond
@using Soenneker.Blazor.FilePond.Options
@using Soenneker.Blazor.FilePond.Dtos
@using Soenneker.Blazor.FilePond.Enums
@using Soenneker.Blazor.TomSelect
@using Soenneker.Blazor.TomSelect.Configuration
@using Soenneker.Blazor.TomSelect.Enums
@using FlatpickrBlazor
@using FlatpickrBlazor.Components
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager


<!-- Quill CSS -->
<link rel="stylesheet" href="@($"{NavigationManager.BaseUri}assets/libs/quill/quill.snow.css")">


<!-- Start::page-header -->
<div class="page-header-breadcrumb mb-3">
    <div class="d-flex align-center justify-content-between flex-wrap">
        <h1 class="page-title fw-medium fs-18 mb-0">Blog Create</h1>
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="javascript:void(0);">
                    Pages
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="javascript:void(0);">
                    Blog
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Blog Create</li>
        </ol>
    </div>
</div>
<!-- End::page-header -->

<!-- Start::row-1 -->
<div class="row">
    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12">
        <div class="card custom-card">
            <div class="card-header">
                <div class="card-title">New Blog</div>
            </div>
            <div class="card-body">
                <div class="row gy-3">
                    <div class="col-xl-12">
                        <label for="blog-title" class="form-label">Blog Title</label>
                        <input type="text" class="form-control" id="blog-title" placeholder="Blog Title">
                    </div>
                    <div class="col-xl-12">
                        <label for="blog-category" class="form-label">Blog Category</label>
                        @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_blogCategoryOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                        }
                    </div>
                    <div class="col-xl-6">
                        <label for="blog-author" class="form-label">Blog Author</label>
                        <input type="text" class="form-control" id="blog-author" placeholder="Enter Name">
                    </div>
                    <div class="col-xl-6">
                        <label for="blog-author-email" class="form-label">Email</label>
                        <input type="text" class="form-control" id="blog-author-email" placeholder="Enter Email">
                    </div>
                    <div class="col-xl-6">
                        <label for="publish-date" class="form-label">Publish Date</label>
                        <Flatpickr class="form-control" @ref="_flatpickr" placeholder="Choose date"/>
                    </div>
                    <div class="col-xl-6">
                        <label for="publish-time" class="form-label">Publish Time</label>
                        <Flatpickr class="form-control" @ref="_Publishtime" Options="@_PublishtimeOptions" placeholder="Choose time" />
                    </div>
                    <div class="col-xl-6">
                        <label for="product-status-add" class="form-label">Published Status</label>
                        @if (isRendered)
                        {
                            <TomSelect TItem="SelectItem" Items="_selectedItems" TType="string" Multiple="false" @bind-Value="_selectedValue" Data="_publishedStatusOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder="Search" Configuration="_configuration" />
                        }
                    </div>
                    <div class="col-xl-6">
                        <label for="blog-tags" class="form-label">Blog Tags</label>
                        @if (isRendered)
                        {
                            <TomSelect TItem="TagItem" Items="_tagItems" TType="string" Multiple="true" @bind-Value="_tagValue" Data="_blogTagOptions" TextField="@(item => item.Name)" ValueField="@(item => item.Id)" Placeholder=""  persist= "false" Create = "true" Configuration="_configuration2" />
                        }
                    </div>
                    <div class="col-xl-12">
                        <label class="form-label">Blog Content</label>
                        <div id="blog-content">
                        <BlazoredTextEditor  @ref="@QuillHtml">
                                    <ToolbarContent>
                                        <span class="ql-formats">
                                            <select class="ql-header">
                                                <option value="1"></option>
                                                <option value="2"></option>
                                                <option value="3"></option>
                                                <option value="4"></option>
                                                <option value="5"></option>
                                                <option value="6"></option>
                                                <option selected=""></option>
                                            </select> 
                                        </span>
                                        <span class="ql-formats">
                                            <select class="ql-font">
                                                <option selected=""></option>
                                                <option value="serif"></option>
                                                <option value="sans serif"></option>
                                                <option value="monospace"></option>
                                            </select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-bold"></button>
                                            <button class="ql-italic"></button>
                                            <button class="ql-underline"></button>
                                            <button class="ql-strike"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-blockquote" value="blockquote"></button>
                                            <button class="ql-code-block" value="code-block"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-header" value="1"></button>
                                            <button class="ql-header" value="2"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-list" value="ordered"></button>
                                            <button class="ql-list" value="bullet"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <select class="ql-color"></select>
                                            <select class="ql-background"></select>
                                        </span>
                                        <span class="ql-formats">
                                            <select class="ql-align">
                                                <option selected=""></option>
                                                <option value="center"></option>
                                                <option value="right"></option>
                                                <option value="justify"></option>
                                            </select>
                                        </span>
                                         <span class="ql-formats">
                                            <button class="ql-image"></button>
                                            <button class="ql-video"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-clean"></button>
                                        </span>
                                    </ToolbarContent>
                                </BlazoredTextEditor >
                        </div>
                    </div>
                    <div class="col-xl-12 blog-images-container">
                        <label for="blog-author-email" class="form-label">Blog Images</label>
                         @if (isRendered)
                            {
                                <FilePond @ref="FilePond" Options="_Attachments"></FilePond>
                            }
                    </div>
                    <div class="col-xl-12">
                        <label class="form-label">Blog Type</label>
                        <div class="d-flex align-items-center">
                            <div class="form-check me-3">
                                <input class="form-check-input" type="radio" name="blog-type" id="blog-free1" checked>
                                <label class="form-check-label" for="blog-free1">
                                    Free
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="blog-type" id="blog-paid1">
                                <label class="form-check-label" for="blog-paid1">
                                    Paid
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="btn-list text-end">
                    <button type="button" class="btn btn-sm btn-light">Save As Draft</button>
                    <button type="button" class="btn btn-sm btn-primary">Post Blog</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--End::row-1 -->

@code{

    //QuilEditor JS Start
    BlazoredTextEditor?  QuillHtml;
    //QuilEditor JS End
    
    // Date picker Start//
    public Flatpickr? _flatpickr;
    // Date picker End//

    // Time Picker Start//
    public Flatpickr? _Publishtime;
    private FlatpickrOptions _PublishtimeOptions = new FlatpickrOptions
    {
        Inline = false,
        EnableTime = true,
        NoCalendar = true,
        DateFormat = "H:i",
        DefaultDate = new List<string> { "13:45" }
    };  
    // Time Picker End// 

    private bool isRendered = false;  
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isRendered = true;
            await Task.Delay(0);
            StateHasChanged(); 
        }
    }

    // Filepond Start //
    private FilePond? FilePond { get; set; }
    private readonly FilePondOptions _Attachments = new()
    {
        MaxFiles = 6,
        AllowMultiple = true,
    };

    private TomSelect<SelectItem, string> _selectedValue = default!;
    private List<SelectItem>? _blogCategoryOptions;      
    private List<SelectItem>? _publishedStatusOptions;      
    private List<SelectItem> _selectedItems = new List<SelectItem>();    
    public class SelectItem
    {
        public string? Id { get; set; }
        public string? Name { get; set; }
        public bool Selected { get; set; }
    }

    
    private TomSelect<TagItem, string> _tagValue = default!;
    private List<TagItem>? _blogTagOptions;   
    private List<TagItem> _tagItems = new List<TagItem>();    
    public class TagItem
    {
        public string? Id { get; set; }
        public string? Name { get; set; }
        public bool Selected { get; set; }
    } 

    private readonly TomSelectConfiguration _configuration = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.DropdownInput, TomSelectPluginType.NoBackspaceDelete }
    };
    private readonly TomSelectConfiguration _configuration2 = new()
    {
        Plugins = new List<TomSelectPluginType> { TomSelectPluginType.RemoveButton, TomSelectPluginType.NoBackspaceDelete }
    };
    protected override void OnInitialized() {

        _blogCategoryOptions = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "Nature" },
            new SelectItem { Id = "1", Name = "Kiara" },
            new SelectItem { Id = "2", Name = "Food" },
            new SelectItem { Id = "3", Name = "Travel" },
            new SelectItem { Id = "4", Name = "Fashion" },
            new SelectItem { Id = "5", Name = "Beauty" },
        };
        _selectedItems = _blogCategoryOptions.Take(1).ToList();

        _publishedStatusOptions = new List<SelectItem>
        {
            new SelectItem { Id = "0", Name = "Published" },
            new SelectItem { Id = "1", Name = "Hold" },
        };
        _selectedItems = _publishedStatusOptions.Take(1).ToList();

         _blogTagOptions = new List<TagItem>
        {
            new TagItem { Id = "0", Name = "Top Blog" },
            new TagItem { Id = "1", Name = "Blogger" },
            new TagItem { Id = "2", Name = "Adventure" },
            new TagItem { Id = "3", Name = "Landscape" },
        };
        _tagItems = _blogTagOptions.Take(3).ToList();   
    }
}